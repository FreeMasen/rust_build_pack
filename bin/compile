#! /bin/bash
beginswith() { case $2 in "$1"*) true;; *) false;; esac; }
echo "-----> Getting a fresh copy of Rust"
curl https://sh.rustup.rs -sSf >> $1/ru.sh
sh $1/ru.sh -y
MANPATH=$1/Cargo.toml
echo "-----> Manifest Path: $MANPATH"
echo "-----> Capturing the app name"
while read l; do
  if beginswith "name = " "$l"; then
    echo "-----> Found App Name $l"
    RUSTAPPNAME=${l:8}
    RUSTAPPNAME=${RUSTAPPNAME::${#RUSTAPPNAME}-1}
    export RUSTAPPNAME
    break
  fi
done <$MANPATH
echo "-----> App Name: $RUSTAPPNAME"
echo "-----> Building the project"
~/.cargo/bin/cargo build --manifest-path $MANPATH --release -vv
echo "-----> Copying the binary to the build dir"
cp $1/target/release/$RUSTAPPNAME $1/$RUSTAPPNAME
